{extend name="default/base" /}
{block name="title"}首页 - {if $pageId > 0}{$customPageTitle}{else}{__block__}{/if}{/block}
{block name="css"}
<link rel="stylesheet"  href="__STATIC__/plugins/swiper/swiper.min.css"/>
<link rel="stylesheet"  href="__WECHAT__/css/index.css?v={$v}">
{/block}
{block name="header"}
{if $pageId == 0}
    <header class="ui-header ui-header-positive {if($subscribe==1)} wst-in-change{/if} wst-in-header" id="j-header">
    </header>
    <div class="wst-in-search {if($subscribe==1)} wst-in-change{/if}">
    	<div class="classify"><a href="{:url('wechat/goodscats/index')}"><i></i></a></div>
    	<div class="searchs" id="j-searchs" onclick="javascript:WST.searchPage('goods',1);">
		    <i class="ui-icon-search" onclick="javascript:WST.searchPage('goods',1);"></i>
		    <form action＝"" class="input-form">
		    <input type="search" placeholder="按关键字搜索艺术品/艺廊/艺术家" onsearch="WST.search(0)" autocomplete="off" disabled="disabled">
			</form>
			<div class="wst-clear"></div>
		</div>
		<div class="user"><a href="{:url('wechat/messages/index')}">{if condition="session('WST_USER.userId') >0"}<i>{if($news['message']['num']>0)}<span class="number">{$news['message']['num']}</span>{/if}</i>{else}登录{/if}</a></div>
	</div>
    {if($subscribe==1)}
    <div class="wst-in-public">
        <div class="back"></div>
        <div class="public"><div class="public2">
        	<i class="ui-icon-close-page" onclick="javascript:closeFollow();"></i>
    		<div class="logo"><a><img src="__RESOURCE_PATH__/{:WSTConf('CONF.mallLogo')}"></a></div>
    		<div class="prompt"><p>您尚未关注公众号</p><p>点击右边按钮立即关注</p></div>
			<button class="button" onclick="javascript:forFollow();">立即关注</button>
			<div class="wst-clear"></div>
    	</div></div>
    </div>
   	{/if}
{/if}
{/block}
{block name="main"}
<input type="hidden" class="hasShop" value="{$hasShop}">
{if $pageId == 0}
<input type="hidden" name="" value="-1" id="currPage" autocomplete="off">
<section class="ui-container">
		<div class="swiper-container banner">
			<div class="swiper-wrapper">
          		{wst:ads code="wx-ads-index" cache='86400'}
                <div class="swiper-slide" style="width:100%;">
                	<div class="ads"><a href="{$vo.adURL}"><img src="__RESOURCE_PATH__/{:WSTImg($vo.adFile,2)}"></a></div>
                </div>
                {/wst:ads}
          	</div>
          	<div class="swiper-pagination"></div>
        </div>

		<div class="ui-row wst-in-choose">
		    {volist name=':WSTMobileBtns(1)' id='btn'}
		    <div class="ui-col ui-col-20">
		    <?php if(stripos($btn['btnUrl'],'https://') !== false || stripos($btn['btnUrl'],'http://') !== false){ ?>
		    <a href="{$btn['btnUrl']}">
		    <?php }else{ ?>
		    <a href="__ROOT__/{$btn['btnUrl']}">
		    <?php } ?>
		    <p><img src="__RESOURCE_PATH__/{$btn['btnImg']}" style='margin-top:7px;'/></p>
		    <span>{$btn['btnName']}</span>
		    </a></div>
		    {/volist}
		</div>

		<div class="wst-in-adst">
			{wst:ads code="wx-index-left" cache='86400' num='1'}
			<a class="advert2" href="{$vo.adURL}"><img src="__RESOURCE_PATH__/{:WSTImg($vo.adFile,2)}" style="height:2rem;"/></a>
			{/wst:ads}
			{wst:ads code="wx-index-right" cache='86400' num='2'}
			<a class="advert2" href="{$vo.adURL}"><img src="__RESOURCE_PATH__/{:WSTImg($vo.adFile,2)}" style="height:0.995rem;"/></a>
			{/wst:ads}
			<div class="wst-clear"></div>
		</div>

		
		<?php
			for($i=0;$i<3;$i++){
				if($i==0)	$shopId=124;
				elseif($i==1) $shopId=3;
				elseif($i==2) $shopId=29;
				$shopInfo = mnGetShopInfo($shopId);
		?>
		<div class="wst-in-title colour0">
			<div class="name">
				<p style="float:left;margin-left:0;"><span style="font-size:0.15rem;">{$shopInfo['shopName']}</span></p>
				<p style="float:right;margin-right:5%;text-align:right">
				  <a href="{:url('wechat/shops/index','shopId='.$shopId)}">
					<span style="color:#d30322;font-size:0.15rem">更多>></span>
				  </a>
				</p>
			</div>
		</div>
		<div class="wst-in-back">
		{wst:shopgoods type="recom" num='8' id="racb" shop='$shopId' cache='60'}
		<div class="wst-in-goods">
			<div class="img j-imgAdapt"><a href="javascript:void(0);" onclick="javascript:WST.intoGoods({$racb.goodsId});"><img src="__ROOT__/{:WSTConf('CONF.goodsLogo')}" data-echo="__ROOT__/{$racb.goodsImg}" title="{$racb.goodsName}"/></a></div>
			<div style="background-color:#eee;width:100%;height:0.45rem">
				<div class="name ui-nowrap-multi" onclick="javascript:WST.intoGoods({$racb.goodsId});">{$racb.goodsName}</div>
				<div class="info2">{$racb.goodsAuthor}</div>
				<div class="info3">{$racb.thumbsNum}</div>
			</div>
		</div>
		{/wst:shopgoods}
		</div>
		<div class="wst-clear"></div>
		<?php } ?>

	<div class="wst-in-title colour0">
		<div class="name">
			<p style="float:left"><span>艺术家工作室</span></p>
			<p style="float:right;margin-right:5%;text-align:right">
				<a href="{:url('wechat/shops/shopstreet','type=1')}">
					<span style="color:#d30322;font-size:0.15rem">更多>></span>
				</a>
			</p>
			<p style="float:right;">
				<span style="color:#000;font-size:0.15rem;">&nbsp;持续建设中&nbsp;</span>
			</p>
		</div>
	</div>
	<div class="wst-in-back">
		{wst:shop cat="1" num="6" id="sp"}
		<div class="wst-in-goods" style="width:48.5%;height:1.8rem">
			<div class="imgbrd"><a href="{:url('wechat/shops/index','shopId='.$sp.shopId)}"><img src="__ROOT__/{:WSTConf('CONF.goodsLogo')}" data-echo="__ROOT__/{$sp.shopImg}" style="max-width:100%;max-height:100%;position:absolute;margin:auto;top:0;bottom:0;left:0;right:0"/></a></div>
			<div class="name ui-nowrap-multi">{$sp.shopName}</div>
		</div>
		{/wst:shop}
	</div>
	<div class="wst-clear"></div>

	<?php
			for($i=0;$i<1;$i++){
				if($i==0)	$shopId=125;
				$shopInfo = mnGetShopInfo($shopId);
		?>
	<div class="wst-in-title colour0">
		<div class="name">
			<p style="float:left;margin-left:0;"><span style="font-size:0.15rem;">{$shopInfo['shopName']}</span></p>
			<p style="float:right;margin-right:5%;text-align:right">
				<a href="{:url('wechat/shops/index','shopId='.$shopId)}">
					<span style="color:#d30322;font-size:0.15rem">更多>></span>
				</a>
			</p>
			{if $i==0 }
			<p style="float:right;">
				<span style="color:#000;font-size:0.15rem;">&nbsp;作品征集中&nbsp;</span>
			</p>
			{/if}
		</div>
	</div>
	<div class="wst-in-back">
		{wst:shopgoods type="recom" num='8' id="racb" shop='$shopId' cache='60'}
		<div class="wst-in-goods">
			<div class="img j-imgAdapt"><a href="javascript:void(0);" onclick="javascript:WST.intoGoods({$racb.goodsId});"><img src="__ROOT__/{:WSTConf('CONF.goodsLogo')}" data-echo="__ROOT__/{$racb.goodsImg}" title="{$racb.goodsName}"/></a></div>
			<div style="background-color:#eee;width:100%;height:0.45rem">
				<div class="name ui-nowrap-multi" onclick="javascript:WST.intoGoods({$racb.goodsId});">{$racb.goodsName}</div>
				<div class="info2">{$racb.goodsAuthor}</div>
				<div class="info3">{$racb.thumbsNum}</div>
			</div>
		</div>
		{/wst:shopgoods}
	</div>
	<div class="wst-clear"></div>
	<?php } ?>

		<div class="wst-in-activity">
			{wst:ads code="wx-ads0-1" cache='86400' num='4'}<a class="advert4 img" href="{$vo.adURL}"><img src="__ROOT__/{:WSTImg($vo.adFile,2)}"/></a>{/wst:ads}
		</div>
		<div class="wst-clear"></div>

	<div class="wst-in-title colour0">
		<div class="name">
			<p style="float:left;margin-left:0;"><span style="font-size:0.15rem;">活动专区</span></p>
			<p style="float:right;margin-right:5%;text-align:right">
				<a href="{:url('wechat/goods/topicgoods')}">
					<span style="color:#d30322;font-size:0.15rem">更多>></span>
				</a>
			</p>
		</div>
	</div>
	<div class="wst-in-back">
		{wst:goods type="hot" num='8' id="racb" cat="-1"}
		<div class="wst-in-goods">
			<div class="img j-imgAdapt"><a href="javascript:void(0);" onclick="javascript:WST.intoGoods({$racb.goodsId});"><img src="__ROOT__/{:WSTConf('CONF.goodsLogo')}" data-echo="__ROOT__/{$racb.goodsImg}" title="{$racb.goodsName}"/></a></div>
			<div style="background-color:#eee;width:100%;height:0.45rem">
				<div class="name ui-nowrap-multi" onclick="javascript:WST.intoGoods({$racb.goodsId});">{$racb.goodsName}</div>
				<div class="info2">{$racb.goodsAuthor}</div>
				<div class="info3">{$racb.thumbsNum}</div>
			</div>
		</div>
		{/wst:goods}
	</div>
	<div class="wst-clear"></div>

		<div class="wst-in-activity">
			{wst:ads code="wx-ads0-2" cache='86400' num='4'}<a class="advert4 img" href="{$vo.adURL}"><img src="__ROOT__/{:WSTImg($vo.adFile,2)}"/></a>{/wst:ads}
		</div>
		<!--
		<div class="wst-in-title colour0">
			<div class="name">
				<p style="float:left"><span>品牌专区</span></p>
				<p style="width:18%;float:right;margin-right:5%;text-align:right">
				  <a href="{:url('wechat/brands/index')}">
					<span style="color:#d30322;font-size:0.15rem">更多>></span>
				  </a>
				</p>
			</div>
		</div>
		{wst:brand cat="0" num='4' id="brd"}
			<div class="wst-in-goods" style="width:23.8%;height:0.9rem">
				<div class="imgbrd"><a href="javascript:void(0);" onclick="javascript:WST.intoGoods({$brd['catId']});"><img src="__ROOT__/{:WSTConf('CONF.goodsLogo')}" data-echo="__ROOT__/{$brd.brandImg}" style="max-width:100%;max-height:100%;position:absolute;margin:auto;top:0;bottom:0;left:0;right:0"/></a></div>
			</div>
		{/wst:brand}
		<div class="wst-clear"></div>
		<div class="wst-in-activity">
			{wst:ads code="wx-ads0-3" cache='86400' num='4'}<a class="advert4 img" href="{$vo.adURL}"><img src="__ROOT__/{:WSTImg($vo.adFile,2)}"/></a>{/wst:ads}
		</div>
		<div class="wst-in-title colour0">
			<div class="name">
				<p style="float:left"><span>精选艺廊</span></p>
				<p style="width:18%;float:right;margin-right:5%;text-align:right">
				  <a href="{:url('wechat/shops/shopstreet','type=0')}">
					<span style="color:#d30322;font-size:0.15rem">更多>></span>
				  </a>
				</p>
			</div>
		</div>
		<div class="wst-in-back">
		{wst:shop cat="0" num="4" id="sp"}
			<div class="wst-in-goods" style="width:48.5%;height:1.8rem">
				<div class="imgbrd"><a href="{:url('wechat/shops/index','shopId='.$sp.shopId)}"><img src="__ROOT__/{:WSTConf('CONF.goodsLogo')}" data-echo="__ROOT__/{$sp.shopImg}" style="max-width:100%;max-height:100%;position:absolute;margin:auto;top:0;bottom:0;left:0;right:0"/></a></div>
				<div class="name ui-nowrap-multi">{$sp.shopName}</div>
			</div>
		{/wst:shop}
		</div>

		<div id="goods-list"></div>
		-->
		<div class="wst-in-activity">
			{wst:ads code="wx-ads-bt" cache='86400' num='4'}<a class="advert4 img" href="{$vo.adURL}" style="height:0.3rem"><img src="__ROOT__/{:WSTImg($vo.adFile,2)}"/></a>{/wst:ads}
		</div>
</section>
<script id="list" type="text/html">

	{{# if(d.ads && d.ads.length>0){ }}
		<div class="wst-in-adscats"><a href="{{ d.ads[0].adURL }}"><img src="__RESOURCE_PATH__/{{ d.ads[0].adFile }}"/></a></div>
	{{# } }}
	{{# if(d.goods.length>0){ }}
		<div class="wst-in-title colour0" onclick="javascript:getGoodsList({{ d.catId }});">
			<div class="name">
				<p style="float:left"><span>{{ d.catName }}</span></p>
				<p style="width:30%;float:right;margin-right:5%;text-align:right">
					<span style="color:#d30322;font-size:0.15rem">更多>></span>
				</p>
			</div>
		</div>
		<div class="wst-in-back">
		{{# for(var i=0; i<d.goods.length; i++){ }}
			<div class="wst-in-goods {{# if((i)%2==0){ }}left{{# }else{ }}right{{# } }}">
				<div class="img j-imgAdapt"><a href="javascript:void(0);" onclick="javascript:WST.intoGoods({{ d.goods[i].goodsId }});"><img src="__RESOURCE_PATH__/{:WSTConf('CONF.goodsLogo')}" data-echo="__RESOURCE_PATH__/{{ d.goods[i].goodsImg }}" title="{{ d.goods[i].goodsName }}"/></a></div>
				<div class="name ui-nowrap-multi" style="text-align:center" onclick="javascript:WST.intoGoods({{ d.goods[i].goodsId }});">{{ d.goods[i].goodsName }}</div>
				<div style="background-color:#eeeeee;height:0.44rem">
					<!--<div class="info2" style="text-align:center;width:100%;background-color:#eeeeee">{{# if(d.goods[i].goodsAuthor!=null){ }}{{ d.goods[i].goodsAuthor }} {{# } }}</div>-->
					<div class="info2">{{# if(d.goods[i].goodsAuthor!=null){ }}{{ d.goods[i].goodsAuthor }} {{# } }}</div>
					<div class="info3">{{ d.goods[i].thumbsNum }}</div>
				</div>
			</div>
		{{# } }}
		</div>
	{{# } }}
<div class="wst-clear"></div>
</script>
{else}
<div class="decoration-container">
	{:action('index/loadCustomPage',array('pageId'=>$pageId))}
</div>
{/if}
{/block}
{block name="include"}
{/* 遮盖层  */}
<div class="wst-cover" id="cover"></div>
{/* 二维码对话框*/}
<div class="ui-dialog" id="wst-di-weixincode" onclick="javascript:WST.dialogHide('weixincode');">
    <div class="ui-dialog-cnt wst-di-weixincode">
        <div class="wst-dialog-bd">
        	<p class="title">长按识别二维码</p>
            <div><img src="__RESOURCE_PATH__/{:WSTConf('CONF.wxAppLogo')}" style="width: 100%;"></div>
            <p class="prompt">请长按上图并选择识别关注图中二维码</p>
        </div>
    </div>
</div>
{include file="default/goods_search_box" /}
{/block}
{block name="js"}
<script type='text/javascript' src='__STATIC__/plugins/swiper/swiper.min.js'></script>
<script type='text/javascript' src='__WECHAT__/js/index.js?v={$v}'></script>
{if(!empty($datawx))}
<script src="{:request()->scheme()}://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
var latitude = '';
var longitude = '';
var hasShop = $('.hasShop').val();
wx.config({
    debug: false,
    appId: '<?php echo WSTConf('CONF.wxAppId'); ?>', //公众号的唯一标识
    timestamp: '<?php echo $datawx['timestamp'];?>', //生成签名的时间戳
    nonceStr: '<?php echo $datawx['noncestr'];?>', //生成签名的随机串
    signature: '<?php echo $datawx['signature'];?>',//签名
    jsApiList: [ //需要使用的JS接口
       	'onMenuShareTimeline',
		'onMenuShareAppMessage',
		'onMenuShareQQ',
		'onMenuShareWeibo',
		'onMenuShareQZone',
		'getLocation'
    ]
});
wx.ready(function(){
	var shareData = {
			title: "{:WSTConf('CONF.mallName')}",
			desc: "{:WSTConf('CONF.mallSlogan')}",
			link: "{:url('wechat/index/index','',true,true)}",
			imgUrl: "{:WSTDomain()}/{:WSTConf('CONF.mallLogo')}"
	};
	wx.onMenuShareAppMessage(shareData);
	wx.onMenuShareTimeline(shareData);
	wx.onMenuShareQQ(shareData);
	wx.onMenuShareWeibo(shareData);
	wx.onMenuShareQZone(shareData);
	if(hasShop == 1){
		//如果不支持则不会执行
		wx.getLocation({type: 'gcj02',
			success: function (res) {
				latitude = res.latitude;
				longitude = res.longitude;
				shopsList(latitude,longitude);
			},
			cancel: function (res) {
				shopsList(0,0);
			}
		});
	}
});
</script>
{/if}
{/block}